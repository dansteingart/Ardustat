<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name ="viewport" content="width=device-width">
    <title>Channel 1</title>
    <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.min.css"> 
    <link rel="stylesheet" href="/stylesheets/style.css">
</head>

<body>
  <div class="container">
    <div class="row marketing">
    
      <div class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Ardustat</a>
          </div>
          <nav class="collapse navbar-collapse" role="navigation">
            <ul class="nav navbar-nav navbar-right">
                <li id='navbar-home'><a href="/">Home</a></li>
                <li id='navbar-channel1'><a href="/Channel1">Channel 1</a></li>
                <li id='navbar-channel2'><a href="/Channel2">Channel 2</a></li>
                <li id='navbar-channel3'><a href="/Channel3">Channel 3</a></li>
                <li id='navbar-analysis'><a href="/Analysis">Analysis</a></li>
            </ul>
          </nav>
        </div>
        <script type="text/javascript" >
            document.getElementById('navbar-analysis').setAttribute('class', 'active')
          </script>
      </div>
   I know this is ugly - I will make it prettier.
      <h1>Analysis</h1>

      <div class"row">
        <div class="col-lg-4">
  		    <h4>Folders</h4>
  		    ##_newthings_##
        </div>
        <div class="col-lg-4"> 
          <h4>Files</h4>
          <div id='files_div'>
            <select onChange="files_drop_change(this)" id="files">
              <option value="">Select File</option>
            </select>
          </div>
        </div>
        <div class="col-lg-4">
          <h4>Download File</h4>
          Coming Soon
           <a id="file_to_download" download style="display:none"> Select File To Download </a>
      </div>

      <div class="col-lg-12">
      </div>

      <div class="row">
        <div class="col-lg-12">
          <h3> Setup </h3> 
          <div id="show_setup">

          </div> 
        </div>
      </div>

      <div class="row">
        <div class ="col-lg-12">
          <h3> Graph </h3> 
          <img id="graph" src="http://www.herbergertheater.org/wp-content/uploads/2014/12/Image-Coming-Soon-Placeholder.png" width="800" height="678" style="display:none">
        </div>
      </div>
      <div class="row">
        <div class="col-lg-4">
          <table id="graph_buttons" style="display:none"><tr>
                <td><button type="button" class="btn btn-default" id="chooseP1" onclick="chooseP(1,analysis_get_image)">Current vs. Voltage</button></td>
                <td><button type="button" class="btn btn-default" id="chooseP2" onclick="chooseP(2,analysis_get_image)">Current vs. Time</button></td>
                <td><button type="button" class="btn btn-default" id="chooseP3" onclick="chooseP(3,analysis_get_image)">Voltage vs. Time</button></td> </tr>
          </table><br>
        </div>
      </div>

    </div>
  </div>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" ></script>
	<script src="/javascripts/flot/jquery.flot.js"></script>
	<script src="/javascripts/flot/jquery.flot.time.js"></script>
	<script src="/javascripts/jquery-json/src/jquery.json.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  <script src ="/scripts/test.js"></script>
  <script src="/scripts/socket_1.js"></script>
  <script>

  var analysis_folder_name
  files = '';
  countto = ''
    

  function changePlot(xaxis,yaxis,callback)
  {
    callback();
  }
  
  x_axis = ''
  y_axis = ''

  function chooseP(ptype,callback) 
  { plot = ptype; 
    selected = true;
    if(plot == 1) { x_axis = 'v'; y_axis = 'c' }
    if(plot == 2) { x_axis = 't'; y_axis = 'c'  }
    if(plot == 3) { x_axis = 't'; y_axis = 'v'  }
    callback()
  }

  address = ''
  function analysis_get_image()
    {
        //TODO: add in a cycmin and cycmax thing
        if (x_axis == '') x_axis = 't'
        if (y_axis == '') y_axis = 'v'
        analysis_file_name = address
        console.log('analysis_get_image called for ' + address)

        this_host = document.URL.toString().split('/')[2]
        colon_index = this_host.indexOf(':')
        this_host = this_host.substring(0,colon_index)
        console.log(this_host)
        url = "http://"+this_host+":4004/filetest_clean/" 
        + analysis_folder_name+"/"
        + analysis_file_name+"/"
        + x_axis+"/"
        + y_axis+"/"
        console.log(url)
        this_host = document.URL.toString().split('/')[2]
        colon_index = this_host.indexOf(':')
        this_host = this_host.substring(0,colon_index)
        console.log(this_host)
        $.ajax({
        url: url,
        success: function(result){
            image = result
            imageUrl = "http://"+this_host+":4001/"+image
            console.log(imageUrl)

            changeImage("graph",imageUrl)

        },
        async:   true,
        })
        $.ajax({
          type:'GET', 
          url:'/show_setup/'+analysis_folder_name+'/'+analysis_file_name,
          dataType: 'json',
          async: true,
          success: function(data){
            console.log('show_setup called');
            console.log(JSON.stringify(data))
            show_setup(data)
            show_graph_buttons()
          }
        });
    }

function get_id_and_image()
  {
    analysis_file_name = address
    $.ajax({
      type:'GET', 
      url:'/show_setup/'+analysis_folder_name+'/'+analysis_file_name,
      dataType: 'json',
      async: true,
      success: function(data){
        console.log('show_setup called');
        console.log(JSON.stringify(data))
        show_setup(data)
        get_raw_image()
        show_graph_buttons()
        ardustat_id = data.ardustat_id
        console.ardustat_id
      }
    });
  }


  function get_raw_image(){
    console.log('get_raw_image called')
    if (x_axis == '') { x_axis = 't'}
    if (y_axis == '') { y_axis = 'v'}
    var mintemp = 0;
    var maxtemp = -1;

    ardustat_id = 25

    if (countto = '') countto = 1

    if(mintemp != "") { cycle_min = mintemp; }
    else { cycle_min = 0 }
    if(maxtemp != "") { cycle_max = maxtemp; }
    else { cycle_max = -1 }

    if (countto == '') countto = 1

    this_host = document.URL.toString().split('/')[2]
    colon_index = this_host.indexOf(':')
    this_host = this_host.substring(0,colon_index)
    console.log(this_host)
    url = "http://"+this_host+":4004/filetest_showme_basic_averaging_analysis/" 
    + analysis_folder_name+"/"
    + analysis_file_name+"/"
    + cycle_min+"/"
    + cycle_max+"/"
    + x_axis+"/"
    + y_axis+"/"
    + ardustat_id+"/"
    + countto + "/"
    + "end/"
    console.log(url)

    //add functionality so that can look at different plots
    var foo = "test";
    $.ajax({
    url: url
    })
    .done(function( data ) {
        console.log('.');
        image = data
        imageUrl = "http://"+this_host+":4001/"+image
        //document.write(imageUrl);
        console.log(imageUrl);
        changeImage("graph",imageUrl)
    })
    .fail(function( jqXHR, textStatus, errorThrown ) {
      console.log('something went wrong');
      console.log(jqXHR);
      console.log(textStatus);
      console.log(errorThrown);
    });

  }
  
  function show_graph_buttons(){
    console.log('show_graph_buttons called')
    document.getElementById('graph_buttons').style.display='inline-block'
  }

  function show_setup(data)
  {
    //display data in raw json stuff 
    document.getElementById('show_setup').innerHTML=JSON.stringify(data)
  }


  function changeImage(id,source)
  {
    document.getElementById(id).src=source;
  }

  function folder_drop_change(selector)
  {
    console.log(selector.value)
    analysis_folder_name = selector.value;
    console.log(analysis_folder_name);
    //make an AJAX request to get file_list 
    //display file_list
    $.ajax({
      type:'POST',
      url:'/show_files',
      async: true,
      data: {'folder':analysis_folder_name},
      success: function(results)
      {
        console.log('successful sending of things :)')
        files = results;
        console.log(files);
        showFiles_drop(files);
      }   
    });  
  }

  function showFiles_drop(files){
        dom_files = document.getElementById('files');
    while (dom_files.firstChild) {
      dom_files.removeChild(dom_files.firstChild)
    }
    first_option = document.createElement('option');
    first_option.setAttribute('value', '')
    first_option.text = 'Select File'
    dom_files.appendChild(first_option);
    for (var i in files){
      foo = files[i].toString()
      //if ( (foo.indexOf('raw') > -1 ) || (foo.indexOf('setup') > -1 ) || (foo.indexOf('clean') == -1) ){ }
      if ( (foo.indexOf('raw') > -1 ) || (foo.indexOf('setup') > -1 ) || (foo.indexOf('pickle') > -1 ) ){ }
      else {
        console.log('file is '+ foo);
        this_option = document.createElement('option');
        this_option.type = "option"
        this_option.setAttribute('id', foo)
        this_option.setAttribute('value', foo)
        this_option.text = foo
        dom_files.appendChild(this_option)
      } 
    }
  }

  function files_drop_change(selector)
  {
    console.log('files_drop_change called')
    console.log(selector.value)
    console.log(selector.value.indexOf('_clean'))
    if (selector.value != '') 
    {
      if (selector.value.indexOf('_clean') > -1)
      {
          address=selector.value
          console.log('file name is ',address)
          //show_download(selector.value)
          analysis_get_image()
      }
      else 
      {
        address = selector.value
        get_id_and_image()
      }
    document.getElementById('graph').style.display="inline-block"
    }
  }
/*
  function show_download(selector) 
  {
    console.log('show_download called')
    var x = document.getElementById('file_to_download')
    x.setAttribute("href","../../Data/cyc/"+selector)
    x.setAttribute("style","display:inline-block")
    x.text = selector
  }
*/



  </script>
</body>
